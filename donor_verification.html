<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Become a Verified Donor - FoodRescue Network</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-green': '#1E392A',
                        'brand-dark-green': '#14281D',
                        'brand-light-cream': '#F8F7F4',
                        'brand-accent-red': '#C70039',
                        'brand-accent-yellow': '#FFC300',
                        'brand-text': '#333333',
                    },
                    animation: {
                        'pulse-subtle': 'pulse-subtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'pulse-subtle': {
                            '0%, 100%': { opacity: 1, transform: 'scale(1)' },
                            '50%': { opacity: .8, transform: 'scale(1.05)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8F7F4; /* brand-light-cream */
        }
        /* Style for the main container background */
        .verification-container {
            background-image: linear-gradient(to bottom right, #ffffff, #f8f7f4);
        }

        /* Form Input Styling */
        .form-label {
            font-weight: 600;
            color: #4a5568; /* gray-700 */
        }
        .form-input, .form-select {
            border-radius: 0.5rem;
            background-color: #F8F7F4;
            transition: all 0.2s;
            border: 2px solid transparent;
            width: 100%; /* Ensure inputs take full width */
            padding: 0.75rem 1rem;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            background-color: white;
            border-color: #1E392A;
            box-shadow: 0 0 0 3px rgba(30, 57, 42, 0.1);
        }

        /* Step Transition */
        .step-content {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            will-change: transform, opacity;
        }
        .step-content.hidden {
            opacity: 0;
            transform: translateY(20px);
            position: absolute;
            pointer-events: none;
        }

        /* Stepper Styling */
        .stepper-item .stepper-circle {
             transition: all 0.4s ease-in-out;
        }
        .stepper-item.active .stepper-circle {
            background-color: white;
            color: #1E392A;
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
        }
        .stepper-item.active .stepper-title {
            color: white;
        }
        .stepper-item.active .stepper-description {
            color: rgba(255, 255, 255, 0.8);
        }
        .stepper-item.completed .stepper-circle {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        .stepper-item .stepper-line {
            transition: background-color 0.4s ease-in-out;
        }
        .stepper-item.completed .stepper-line {
            background-color: white;
        }
        
        /* Custom Radio Card Styling */
        .donor-type-radio:checked + label {
            border-color: #1E392A;
            background-color: #f0fdf4;
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(30, 57, 42, 0.15);
        }
        .donor-type-radio + label {
            transition: all 0.2s ease-out;
        }
        .donor-type-radio + label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(30, 57, 42, 0.08);
        }
        .donor-type-radio:checked + label i {
            transform: scale(1.1);
        }
        .donor-type-radio + label i {
            transition: transform 0.2s ease-out;
        }

        /* File Upload Area Styling */
        .file-drop-area.dragover {
            background-color: #f0fdf4;
            border-color: #1E392A;
            box-shadow: 0 0 20px rgba(30, 57, 42, 0.1);
        }

        /* Primary Button Style */
        .btn-primary {
            background-color: #1E392A;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 57, 42, 0.2);
        }
        .btn-primary:hover {
            background-color: #14281D;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(30, 57, 42, 0.3);
        }
        .btn-accent {
            background-color: #FFC300;
            color: #14281D;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 195, 0, 0.3);
        }
         .btn-accent:hover {
            background-color: #e6b000;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(255, 195, 0, 0.4);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-8 flex items-center justify-between h-20">
            <a href="index.html" class="text-2xl font-bold text-brand-green flex items-center gap-2">
                <i class="fa-solid fa-seedling"></i>
                <span>FoodRescue</span>
            </a>
            <div class="flex items-center space-x-4">
                <a href="dashboard.html" class="px-4 py-2 text-sm font-semibold text-brand-green rounded-full hover:bg-gray-100">My Dashboard</a>
                <a href="index.html" class="px-4 py-2 bg-brand-accent-red text-white rounded-full text-sm font-semibold hover:bg-opacity-90 shadow-sm">Logout</a>
            </div>
        </nav>
    </header>

    <main class="flex-grow container mx-auto px-4 lg:px-8 py-10" data-aos="fade-up" data-aos-duration="800">
        <div class="verification-container rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <div class="grid grid-cols-1 md:grid-cols-12">
                
                <div class="md:col-span-4 bg-brand-dark-green text-white p-8">
                    <div class="sticky top-28">
                         <div class="mb-8">
                            <i class="fas fa-shield-alt text-3xl text-brand-accent-yellow"></i>
                            <h2 class="text-3xl font-bold mt-2">Donor Verification</h2>
                            <p class="text-white/70 mt-2">Your trust is our priority. A verified profile helps us build a secure network for everyone.</p>
                        </div>

                        <ul class="space-y-4">
                            <li id="stepper-1" class="stepper-item flex items-start active">
                                <div class="flex flex-col items-center mr-4">
                                    <div class="stepper-circle w-10 h-10 border-2 border-white/40 rounded-full flex items-center justify-center font-bold text-lg">1</div>
                                    <div class="stepper-line w-0.5 h-16 bg-white/20 mt-2"></div>
                                </div>
                                <div>
                                    <h3 class="stepper-title font-bold text-white/60">Profile Information</h3>
                                    <p class="stepper-description text-sm text-white/50">Your name, type, and contact details.</p>
                                </div>
                            </li>
                            <li id="stepper-2" class="stepper-item flex items-start">
                                <div class="flex flex-col items-center mr-4">
                                    <div class="stepper-circle w-10 h-10 border-2 border-white/40 rounded-full flex items-center justify-center font-bold text-lg">2</div>
                                    <div class="stepper-line w-0.5 h-16 bg-white/20 mt-2"></div>
                                </div>
                                <div>
                                    <h3 class="stepper-title font-bold text-white/60">Document Upload</h3>
                                    <p class="stepper-description text-sm text-white/50">Upload your ID or business license.</p>
                                </div>
                            </li>
                             <li id="stepper-3" class="stepper-item flex items-start">
                                <div class="flex flex-col items-center mr-4">
                                    <div class="stepper-circle w-10 h-10 border-2 border-white/40 rounded-full flex items-center justify-center font-bold text-lg">
                                        <i class="fa-solid fa-flag-checkered"></i>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="stepper-title font-bold text-white/60">Review & Submit</h3>
                                    <p class="stepper-description text-sm text-white/50">Confirm your details for verification.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="md:col-span-8 p-8 md:p-12 relative min-h-[600px]">
                    <div id="step-1" class="step-content">
                        <h3 class="text-3xl font-bold text-brand-green mb-2">Let's start with your profile.</h3>
                        <p class="text-gray-500 mb-8">This information helps charities know who they're connecting with.</p>
                        <form onsubmit="return false;" class="space-y-6">
                             <div>
                                <label class="form-label block mb-2">I am a...</label>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <input type="radio" name="donor-type" id="type-individual" class="hidden donor-type-radio" checked>
                                    <label for="type-individual" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer text-center">
                                        <i class="fa-solid fa-user text-3xl text-brand-green mb-2"></i>
                                        <span class="font-semibold block">Individual</span>
                                    </label>
                                    <input type="radio" name="donor-type" id="type-restaurant" class="hidden donor-type-radio">
                                    <label for="type-restaurant" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer text-center">
                                        <i class="fa-solid fa-utensils text-3xl text-brand-green mb-2"></i>
                                        <span class="font-semibold block">Restaurant</span>
                                    </label>
                                    <input type="radio" name="donor-type" id="type-supermarket" class="hidden donor-type-radio">
                                    <label for="type-supermarket" class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer text-center">
                                        <i class="fa-solid fa-store text-3xl text-brand-green mb-2"></i>
                                        <span class="font-semibold block">Supermarket</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div>
                                    <label for="full-name" class="form-label">Full Name / Business Name</label>
                                    <input type="text" id="full-name" class="form-input mt-1" placeholder="e.g., Jane Doe or The Corner Market">
                                </div>
                            </div>

                                <div>
                                    <label for="phone-number" class="form-label">Phone Number</label>
                                    <input type="tel" id="phone-number" class="form-input mt-1" placeholder="e.g., 9876543210">
                                </div>

                             <div>
                                <label for="address" class="form-label">Full Address</label>
                                <input type="text" id="address" class="form-input mt-1" placeholder="123, Main Street, Near Rose Garden">
                            </div>

                            <div class="text-right pt-4">
                                <button onclick="changeStep(2)" class="btn-primary px-8 py-3 rounded-full font-bold flex items-center gap-2 ml-auto">
                                    Next: Upload Documents <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="step-2" class="step-content hidden">
                        <h3 class="text-3xl font-bold text-brand-green mb-2">Verify your identity.</h3>
                        <p class="text-gray-500 mb-8">Please upload a valid government ID or business license to ensure trust and safety.</p>
                        <form onsubmit="return false;" class="space-y-6">
                             <div>
                                <label for="doc-type" class="form-label">Document Type</label>
                                <select id="doc-type" class="form-select mt-1">
                                    <option>Aadhaar Card</option>
                                    <option>Business License (FSSAI, etc.)</option>
                                    <option>Driving License</option>
                                    <option>PAN Card</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Upload Document</label>
                                <div id="file-drop-area" class="relative block w-full border-2 border-gray-300 border-dashed rounded-lg p-12 text-center hover:border-brand-green transition-all cursor-pointer mt-1">
                                    <input type="file" class="absolute inset-0 w-full h-full opacity-0" id="file-input" onchange="handleFileSelect(event)">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-400 mb-3"></i>
                                        <p class="text-lg font-semibold text-gray-700">Drag & drop your file</p>
                                        <p class="text-sm text-gray-500 mt-1">or <span class="font-semibold text-brand-green">click to browse</span></p>
                                        <p class="text-xs text-gray-400 mt-2">PNG, JPG, or PDF, up to 10MB</p>
                                    </div>
                                </div>
                                <div id="file-info" class="hidden mt-4 p-3 bg-gray-100 rounded-lg text-sm flex items-center justify-between">
                                    <div class="flex items-center gap-2 overflow-hidden">
                                        <i class="fa-solid fa-file-lines text-gray-600 flex-shrink-0"></i>
                                        <span id="file-name" class="font-medium truncate"></span>
                                    </div>
                                    <button onclick="removeFile()" class="text-red-500 hover:text-red-700 ml-2 flex-shrink-0"><i class="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                            <div class="flex justify-between items-center pt-4">
                                <button onclick="changeStep(1)" class="px-6 py-2 text-brand-green font-semibold hover:bg-gray-100 rounded-full">
                                    <i class="fa-solid fa-arrow-left mr-2"></i> Back
                                </button>
                                <button onclick="changeStep(3)" class="btn-primary px-8 py-3 rounded-full font-bold flex items-center gap-2">
                                    Next: Review <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                     <div id="step-3" class="step-content hidden">
                        <h3 class="text-3xl font-bold text-brand-green mb-2">Almost there!</h3>
                        <p class="text-gray-500 mb-8">Please review your information carefully before submitting.</p>
                        
                        <div class="space-y-6 p-6 bg-brand-light-cream rounded-lg border">
                           <div>
                                <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Profile Information</h4>
                                <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                    <div><p class="text-gray-500 text-sm">Name</p><p class="font-semibold text-brand-text">The Corner Market</p></div>
                                    <div><p class="text-gray-500 text-sm">Donor Type</p><p class="font-semibold text-brand-text">Restaurant</p></div>
                                    <div class="md:col-span-2"><p class="text-gray-500 text-sm">Address</p><p class="font-semibold text-brand-text">123, Main Street, Near Rose Garden</p></div>
                                </div>
                           </div>
                           <div class="border-t pt-6">
                                <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Uploaded Document</h4>
                                <div class="flex items-center gap-3 text-gray-800 mt-2 bg-white p-3 rounded-md border">
                                    <i class="fa-solid fa-file-pdf text-red-500 text-2xl"></i>
                                    <div>
                                        <p class="font-semibold">business_license_fssai.pdf</p>
                                        <p class="text-xs text-gray-500">Business License</p>
                                    </div>
                                </div>
                           </div>
                        </div>

                        <div class="mt-8">
                             <label class="flex items-start">
                                <input type="checkbox" id="terms-agree" class="h-5 w-5 rounded border-gray-300 text-brand-green focus:ring-brand-green mt-1">
                                <span class="ml-3 text-sm text-gray-600">I confirm that the information provided is accurate and I agree to the <a href="#" class="font-semibold text-brand-green hover:underline">Terms of Service</a>.</span>
                            </label>
                        </div>
                        
                        <div class="flex justify-between items-center pt-6">
                            <button onclick="changeStep(2)" class="px-6 py-2 text-brand-green font-semibold hover:bg-gray-100 rounded-full">
                                <i class="fa-solid fa-arrow-left mr-2"></i> Back
                            </button>
                            <button onclick="submitVerification()" class="btn-accent px-8 py-3 rounded-full font-bold flex items-center gap-2">
                                <i class="fa-solid fa-paper-plane"></i> Submit for Verification
                            </button>
                        </div>
                    </div>
                    
                    <div id="confirmation" class="step-content hidden text-center">
                        <div class="flex flex-col items-center justify-center h-full py-12">
                            <div class="w-24 h-24 bg-brand-green/10 rounded-full flex items-center justify-center mb-6">
                               <i class="fa-solid fa-shield-check text-5xl text-brand-green animate-pulse-subtle"></i>
                            </div>
                            <h2 class="text-3xl font-bold text-brand-green mb-2">Application Under Review</h2>
                            <p class="text-gray-600 max-w-md mx-auto mb-8">Thank you! Our team will review your documents and you'll receive a notification within 2-3 business days. You can now proceed to your dashboard.</p>
                            <a href="dashboard.html" class="btn-primary px-8 py-3 rounded-full font-bold inline-block">Go to My Dashboard</a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 600,
                once: true,
            });
        });

        let currentStep = 1;
        const steps = document.querySelectorAll('.step-content');
        const stepperItems = document.querySelectorAll('.stepper-item');

        function changeStep(stepNumber) {
            if (stepNumber < 1 || stepNumber > 3) return;

            const currentStepEl = document.getElementById(`step-${currentStep}`);
            const nextStepEl = document.getElementById(`step-${stepNumber}`);
            
            currentStepEl.classList.add('hidden');
            nextStepEl.classList.remove('hidden');
            
            currentStep = stepNumber;

            // Update stepper visual state
            stepperItems.forEach((item, index) => {
                const stepIndex = index + 1;
                item.classList.remove('active', 'completed');

                if (stepIndex < currentStep) {
                    item.classList.add('completed');
                    const checkIcon = item.querySelector('.stepper-circle');
                    if (!checkIcon.querySelector('i')) {
                         checkIcon.innerHTML = `<i class="fa-solid fa-check"></i>`;
                    }
                } else if (stepIndex === currentStep) {
                    item.classList.add('active');
                } else {
                     const circle = item.querySelector('.stepper-circle');
                     if(index < 2) circle.innerHTML = index + 1;
                }
            });
        }
        
        function submitVerification() {
            // Placeholder; will be overridden by Firebase module below
            console.warn('Firebase not initialized yet.');
        }

        // --- File Upload Logic ---
        const dropArea = document.getElementById('file-drop-area');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const fileNameSpan = document.getElementById('file-name');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragover'), false);
        });

        dropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            let dt = e.dataTransfer;
            let files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(event) {
            handleFiles(event.target.files);
        }
        
        function handleFiles(files) {
            if (files.length > 0) {
                fileNameSpan.textContent = files[0].name;
                fileInfo.classList.remove('hidden');
                dropArea.classList.add('hidden');
            }
        }

        function removeFile() {
            fileInput.value = ''; // Clear the file input
            fileInfo.classList.add('hidden');
            dropArea.classList.remove('hidden');
        }
    </script>
    <script type="module">
        import { auth, db } from './FirebaseConfig.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        let currentUser = null;
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'login.html#register';
            } else {
                currentUser = user;
            }
        });

        function getSelectedDonorType() {
            if (document.getElementById('type-restaurant').checked) return 'restaurant';
            if (document.getElementById('type-supermarket').checked) return 'supermarket';
            return 'individual';
        }

        function getDonorFormData() {
            return {
                donorType: getSelectedDonorType(),
                fullNameOrBusiness: document.getElementById('full-name').value || '',
                phoneNumber: document.getElementById('phone-number').value || '',
                address: document.getElementById('address').value || '',
                documentType: (document.getElementById('doc-type') && document.getElementById('doc-type').value) || '',
            };
        }

        window.submitVerification = async function() {
            if (!currentUser) {
                alert('Please login again to continue.');
                window.location.href = 'login.html#register';
                return;
            }
            const terms = document.getElementById('terms-agree');
            if (terms && !terms.checked) {
                alert('Please agree to the Terms of Service to continue.');
                return;
            }

            const donorProfile = getDonorFormData();
            try {
                await setDoc(doc(db, 'users', currentUser.uid), {
                    role: 'donor',
                    verification_status: 'approved',
                    donor_profile: donorProfile,
                    updated_at: serverTimestamp()
                }, { merge: true });

                // Update UI stepper to completed
                stepperItems[2].classList.add('completed');
                stepperItems[2].classList.remove('active');
                const finalCircle = stepperItems[2].querySelector('.stepper-circle');
                finalCircle.innerHTML = `<i class="fa-solid fa-check"></i>`;
                steps.forEach(step => step.classList.add('hidden'));
                document.getElementById('confirmation').classList.remove('hidden');

                // Navigate to donor dashboard
                setTimeout(() => {
                    window.location.href = 'dashboard.html?role=donor';
                }, 600);
            } catch (err) {
                console.error('Verification update failed', err);
                alert('Failed to submit verification. Please try again.');
            }
        }
    </script>
</body>
</html>